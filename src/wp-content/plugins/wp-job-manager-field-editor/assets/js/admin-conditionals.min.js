window.jmfe_conditionals=window.jmfe_conditionals||{},function(a,b){a={data:{meta_keys:jmfe_meta_keys||[],conditionals:jmfe_conditional_logic||[],checks:jmfe_checks||[],all_checks:jmfe_checks||[]},init:function(){var c=b("#conditionals_title").html();c&&(document.title=c),a.helpers.init(),a.groups.init(),b("#add_group").click(function(){a.logic.clear(),a.group.render()}),b(".con_message").on("click",function(){b(this).closest(".message").transition("fade")}),a.logic.callbacks(),a.groups.callbacks()},get:{group:function(b,c){var d=!1,e=a.data.conditionals;return e&&b?("undefined"!=typeof e[b]&&(d=e[b],d.slug=b),c&&d&&"undefined"!=typeof d[c]&&(d=d[c]),d):!1},config:function(b){var c={group:{name:"",slug:"new_group",type:"show",status:"enabled",fields:[],logic:[]},groups:a.data.conditionals,meta_keys:a.get.meta_keys(),checks:a.get.checks()};return"undefined"!==b&&"undefined"!=typeof c.groups[b]&&(c.group=c.groups[b]),c},groups:function(){var b={groups:a.data.conditionals};return b},meta_keys:function(b){var c=a.data.meta_keys;return b&&(c=Object.keys(c)),c},checks:function(){return a.data.checks}},group:{confirm:{remove:!1},api:{response:{success:function(c,d,e){c&&c.data&&(c.data.message&&(b("#success_content").html(c.data.message),b("#success_message").transition("fade"),setTimeout(function(){b("#success_close").click()},2500)),c.data.conditionals&&(a.data.conditionals=c.data.conditionals),c.data.slug?a.group.render(c.data.slug):c.data.removed&&a.group.clear()),a.groups.list.render()},error:function(a,c,d){b("#group_config_error").html(a).show()},failure:function(a,c){a.data&&a.data.error&&b("#group_config_error").html(a.data.error)}}},init:function(c){b.fn.api.settings.successTest=function(a){return 1==a.success},a.group.dropdowns(c),b("#conditionals_form").api({url:ajaxurl,data:{action:"jmfe_conditionals_save_group"},method:"POST",serializeForm:!0,stateContext:"#conditionals_form",hideError:!0,errorDuration:5e3,onSuccess:function(b,c,d){a.group.api.response.success(b,c,d)},onFailure:function(b,c){a.group.api.response.failure(b,c)},onError:function(b,c,d){a.group.api.response.error(b,c,d)}}),b("#confirm_remove_group").modal({onApprove:function(){a.group.confirm.remove=!0,b("#remove_group").click()}}),b("#remove_group").api({url:ajaxurl,data:{action:"jmfe_conditionals_remove_group"},method:"POST",serializeForm:!0,stateContext:"#conditionals_form",hideError:!0,errorDuration:5e3,beforeSend:function(c){return a.group.confirm.remove?(a.group.confirm.remove=!1,c):(b("#confirm_remove_group").modal("show"),!1)},onSuccess:function(b,c,d){a.group.api.response.success(b,c,d)},onFailure:function(b,c){a.group.api.response.failure(b,c)},onError:function(b,c,d){a.group.api.response.error(b,c,d)}})},dropdowns:function(c){var d=b("#group_fields");if(b("#group_type").dropdown(),b("#group_status").dropdown(),d.dropdown({fullTextSearch:!0,onAdd:function(a,c,d){b('.logic_row_checks > .menu div[data-value="'+a+'"]').addClass("disabled")},onRemove:function(a,c,d){b('.logic_row_checks > .menu div[data-value="'+a+'"]').removeClass("disabled")}}),c){var e=a.get.group(c,"fields");e&&d.dropdown("set exactly",e)}},render:function(c){a.group.clear();var d=a.get.config(c),e=b("#tmpl-group-config").html(),f=Handlebars.compile(e),g=f(d);b("#group_config").html(g),a.group.init(c),c&&"new_group"!==c&&a.logic.init(c)},clear:function(){b("#group_config").html(""),a.logic.clear()}},checks:{selected:!1,update:{group:function(){var c=b(".logic_row_hidden_input").map(function(){return b(this).val()});b(".group_fields_dropdown > .menu > .item").removeClass("disabled"),b.each(c,function(c,d){return d&&d in a.data.meta_keys?void b('.group_fields_dropdown > .menu div[data-value="'+d+'"]').each(function(){b(this).hasClass("selected")||b(this).hasClass("filtered")||b(this).addClass("disabled")}):!0})},section:function(c,d){if(a.checks.selected=c,c in a.data.meta_keys||c===!0){var e=d.find(".logic_row_hidden_input").map(function(){return b(this).val()}),f=b("#group_fields_hidden_input").val();f&&(f=f.split(","),Array.prototype.push.apply(e,f)),d.find(".meta_keys_dropdown > .menu > .item").removeClass("disabled"),b.each(e,function(c,e){return e?void d.find('.meta_keys_dropdown > .menu div[data-value="'+e+'"]').each(function(){b(this).hasClass("selected")||b(this).hasClass("filtered")||b(this).data("value")===a.checks.selected||b(this).addClass("disabled")}):!0}),a.checks.update.group()}}}},groups:{init:function(){a.groups.list.render()},callbacks:function(){b("#groups_list").on("click",".show_group_config",function(c){var d=b(this).data("group");d&&(b(".show_group_config").removeClass("active"),b(this).addClass("active"),a.group.render(d))})},list:{render:function(){var c=a.get.groups(),d=b("#tmpl-groups-list").html(),e=Handlebars.compile(d),f=e(c);b("#groups_list").html(f)}}},logic:{callbacks:function(){b("#group_logic").on("click",".logic_add_section",function(c){var d=b(this).data("group"),e=b(this).data("secid");return a.logic.section.add(d,e),!1}),a.logic.row.callbacks(),a.logic.section.callbacks()},init:function(c){b("#logic_placeholder").hide(),b("#logic_menu").show(),b("#logic_footer").show(),a.logic.row.register(),a.logic.section.render(c)},rows:{init:function(c){c.find(".logic_row_checks").dropdown({fullTextSearch:!0,debug:!0,onChange:function(c,d,e){var f=b(this).closest(".logic_section_wrap");a.checks.update.section(c,f)}}),c.find(".logic_row_comparison").dropdown(),"#group_logic"!==c.selector&&a.checks.update.section(!0,c)}},row:{callbacks:function(){b("#group_logic").on("click",".logic_row_remove",function(a){b(this).closest(".logic_row").remove()})},register:function(){var a=b("#tmpl-logic-row").html();Handlebars.registerPartial("logicRow",a)},add:function(c,d){var e=b("div[data-secid='"+d+"']");if(e){var f=e.find(".logic_row_content"),g=e.find(".logic_row").length,h=b("#tmpl-logic-row").html(),i=Handlebars.compile(h),j={first:!1,checks:a.get.checks(),group:c,secId:d,rowId:g,check:"",compare:"is",value:""};f.append(i(j)),a.logic.rows.init(e)}}},sections:{init:function(){a.logic.rows.init(b("#group_logic")),b(".logic_section_wrap").each(function(){a.checks.update.section(!0,b(this))})}},section:{init:function(c){var d=c instanceof jQuery?c:b("div[data-secid='"+c+"']");a.logic.rows.init(d)},callbacks:function(){b("#group_logic").on("click",".logic_section_remove",function(a){var c=b(this).closest(".logic_section_wrap"),d=b(".logic_section_wrap").index(c);0===d&&c.next().find(".logic_row_or").remove(),c.remove()}).on("click",".add_logic_row",function(c){var d=b(this).data("secid"),e=b(this).data("group");a.logic.row.add(e,d)})},render:function(c){var d=b("#tmpl-logic-section").html(),e=Handlebars.compile(d),f=a.get.config(c);(!f.group.logic||f.group.logic&&f.group.logic.length<1)&&(f.group.logic=[[{check:"",compare:"is",value:""}]]);var g=e(f);b("#logic_content").html(g),a.logic.sections.init()},add:function(c){c||(c=b("#group_slug").val());var d=b(".logic_section_wrap").length,e={first:d,checks:a.get.checks(),group:c,secId:d,rowId:0,check:"",compare:"is",value:"",no_or:1>d},f=b("#tmpl-logic-add-section").html(),g=Handlebars.compile(f),h=g(e);b("#logic_content").append(h),a.logic.section.init(d)}},clear:function(){b("#logic_content").html(""),b("#logic_menu").hide(),b("#logic_footer").hide(),b("#logic_placeholder").show()}},helpers:{init:function(){Handlebars.registerHelper("ifNewGroup",function(a,b){var c=b.fn,d=b.inverse;return a&&"new_group"!==a?d(this):c(this)}),Handlebars.registerHelper("ifNotNewGroup",function(a,b){var c=b.fn,d=b.inverse;return a&&"new_group"!==a?c(this):d(this)}),Handlebars.registerHelper("ifDisabled",function(a,b){var c=b.fn,d=b.inverse;return a&&"disabled"===a?c(this):d(this)}),Handlebars.registerHelper("striptags",function(a){if("undefined"!=typeof a){var b=new RegExp("#([^\\s]*)","g");return a.replace(b,"")}})}}},b(document).ready(a.init)}(jmfe_conditionals,jQuery);