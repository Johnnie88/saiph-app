window.jmfe_dynamictax=window.jmfe_dynamictax||{},function(a,b){a={pageLoad:!1,initFired:!1,$form:b(".job-manager-form"),store:{_store:{},set:function(c,d){d=b.map(d,function(a){return a.toString()}),a.store._store[c]=d},selected:function(c){var d=a.get.selected(c),e=!1;if(!(c in a.store._store))return a.store.set(c,d),d.length<1?!1:d[0];var f=a.store._store[c];return b.each(d,function(a,b){return-1===f.indexOf(b)?(e=b,!1):void 0}),a.store.set(c,d),e},deselected:function(c){var d=!1;if(!(c in a.store._store))return d;var e=a.get.selected(c),f=a.store._store[c];return b.each(f,function(a,b){return-1===e.indexOf(b)?(d=b,!1):void 0}),d}},log:{obj:function(a){return JSON.parse(JSON.stringify(a))}},i18n:jmfe_dynamic_tax_i18n||{placeholder:"Please select from the list below.."},fields:jmfe_dynamic_tax_fields||{},config:jmfe_dynamic_tax_config||{is_mobile:!1},isMobile:function(){return!!a.config.is_mobile},init:{page:function(){a.initFired||(a.initFired=!0,a.$form=b(".job-manager-form"),a.pageLoad=!0,b(".jmfe-dynamic-tax").each(function(){var c=b(this).attr("id");a.init.field(b(this)),a.changed(b("#"+c),{pageLoad:!0})}),a.pageLoad=!1)},field:function(b){var c=b.hasClass("dynamic-single-select");if(c){var d=b.attr("name");d&&-1===d.indexOf("[]")&&b.attr("name",d+"[]")}b.on("select2:select",function(c){a.changed(b,{selected:c.params.data.id})}),b.on("select2:unselect",function(c){a.changed(b,{deselected:c.params.data.id})})}},changed:function(c,d){var e=c.data("meta_key"),f=c.val();if((!e||e.length<1)&&(e=c.attr("id")),"undefined"!=typeof a.fields[e]&&("undefined"==typeof d&&(d={deselected:a.store.deselected(e),selected:a.store.selected(e)}),"undefined"!=typeof d.selected&&a.selected(e,d.selected,d.pageLoad,c),d.deselected&&a.deselected(e,d.deselected),d.pageLoad)){a.pageLoad=!0;var g=c.hasClass("dynamic-single-select");g&&c.data("last_value",f);var h=a.get.existingValue(e);f&&h.length<1&&f.length>0&&(h=f instanceof Array?f:f.split()),a.store.set(e,h),b.each(h,function(b,c){var d=a.check.valueExists(e,c,h);d&&a.selected(e,c,!0)}),a.pageLoad=!1,h=h.join().split(","),b(".job-manager-form").trigger("fedtchange:"+e,{meta_key:e,values:h})}},check:{valueExists:function(c,d,e){var f=!1,g=a.get.term(c,d);if(g&&"undefined"!=typeof g.parent&&d&&"undefined"!=typeof d){var h=g.parent.toString(),i=d.toString(),j=0===parseInt(g.parent)?c:c+"_"+h,k=b("#"+j);if(k.length){var l=k.val();l&&-1!==l.indexOf(i)&&(f=!0)}else e&&-1!==e.indexOf(g.parent)&&(f=!0)}return f}},selected:function(c,d,e,f){d=d===!1?"":d;var g="#"+c+"_"+d,h=a.get.childSingle(c,d);if(!b(g).length){if("undefined"!=typeof f){var i=f.hasClass("dynamic-single-select");if(i){var j=f.data("last_value");j&&""!==j&&a.deselected(c,parseInt(j)),f.data("last_value",d)}}if(""!==d){var k=a.fieldset.build(c,d);if(k){var l=a.get.parent(c,d),m=0!==l?c+"_"+l:c;b(k).insertAfter(".fieldset-"+m);var n={minimumResultsForSearch:20,width:"100%",debug:!0},o=a.get.childPlaceholder(c,d);if(h)o&&(n.placeholder=o,n.allowClear=!0);else{var p=a.get.maxSelections(c,d);n.maximumSelectionLength=p,b(g).data("maxselections",p),o&&(n.placeholder=o)}b(g).select2(n),a.init.field(b(g)),a.trigger.newfieldset(g)}a.pageLoad||b(".job-manager-form").trigger("fedtchange:"+c,{meta_key:c,selected:d,values:a.get.selected(c)})}}},deselected:function(c,d){d=d===!1?"":d;var e=".fieldset-"+c+"_"+d,f=b(e);f&&(a.remove.children(c,d),f.remove(),b(".job-manager-form").trigger("fedtchange:"+c,{meta_key:c,deselected:d,values:a.get.selected(c)}))},fieldset:{build:function(c,d){var e=a.get.childrenIDs(c,d);if(!e||e.length<1)return!1;var f=(a.get.isChild(c,d),b(".fieldset-"+c).html());if(!f)return!1;var g=a.get.parent(c,d),h=0!==g?c+"_"+g:c,i=c+"_"+d,j="";a.get.parentSingle(c,d)&&(j=" dynamic-fieldset-single-"+h);var k=b('<fieldset class="fieldset-'+i+" dynamic-fieldset-"+c+j+'">'+f+"</fieldset>");k.find(".select2-container").remove();var l=k.find("#"+c);l.empty(),l.removeClass("select2-hidden-accessible"),l.removeData("select2-id"),l.removeAttr("data-select2-id");var m=a.get.childSingle(c,d),n=a.get.childPlaceholder(c,d);if(m){if(l.removeAttr("multiple"),l.addClass("dynamic-single-select"),n&&""!==n||(n=b("#"+c).data("placeholder")),!n||""===n){var o=b("#"+c+" option:first");o&&(n=o.html())}}else l.prop("multiple","multiple"),l.removeClass("dynamic-single-select");n&&""!==n||(n=a.i18n.placeholder),l.data("placeholder",n),l.attr("data-placeholder",n),m&&l.append('<option value="">'+n+"</option>"),l.prop("id",i),l.data("meta_key",c),l.addClass("dynamic-"+c);var p=a.get.termLabel(c,d),q=a.get.mkOptLabel(c),r=a.get.mkReqLabel(c),s=(a.get.mkRequired(c),a.get.mkShowRequired(c)),t=a.get.childRequired(c,d),u=b('label[for="'+h+'"]').html(),v=k.find('label[for="'+c+'"]');u&&(q&&""!==q&&(u=u.replace(q,"")),r&&""!==r&&(u=u.replace(r,"")));var w=u+" â†’ "+p;l.css("display","");var x=k.find(".field");t?(s&&r&&""!==r&&(w+=r),x&&x.removeClass("required-field").addClass("required-field"),l.addClass("jmfe-required-select2"),l.prop("required","required")):(!s&&q&&""!==q&&(w+=q),l.removeClass("jmfe-required-select2 jmfe-add-required-attr"),l.removeAttr("required"),x&&x.removeClass("required-field")),v.html(w).attr("for",i);var y=k.find(".description"),z=a.get.description(c,d);y.length?y.html(z):x.append('<small class="description">'+z+"</small>");var A=a.get.existingValue(c);return b.each(e,function(b,d){if(a.get.exclude(c,d))return!0;var e=a.get.termLabel(c,d);e||(e="Unknown");var f=a.pageLoad&&A&&-1!==A.indexOf(d)?' selected="selected"':"";l.append('<option class="level-0" value="'+d+'"'+f+">"+e+"</option>"),m&&""!==f&&l.data("last_value",d)}),k}},get:{childrenIDs:function(b,c){var d=a.get.term(b,c);return d?"undefined"==typeof d.children?[]:d.children:[]},term:function(b,c){return"undefined"==typeof a.fields[b]||"undefined"==typeof a.fields[b].terms||"undefined"==typeof a.fields[b].terms[c]?!1:a.fields[b].terms[c]},termLabel:function(b,c){var d=a.get.term(b,c);return d&&"undefined"!=typeof d.name?d.name:!1},metaKey:function(b){return"undefined"==typeof a.fields[b]?!1:a.fields[b]},childSingle:function(b,c){var d=a.get.metaKey(b);if(!d||"undefined"==typeof d.type)return!0;var e="term-select"===d.type,f=a.get.term(b,c);return f&&"undefined"!=typeof f.child_dropdown&&""!==f.child_dropdown&&"inherit"!==f.child_dropdown&&("single"===f.child_dropdown?e=!0:"multiple"===f.child_dropdown&&(e=!1)),e},parentSingle:function(b,c){var d=a.get.metaKey(b);if(!d||"undefined"==typeof d.type)return!0;var e=a.get.parent(b,c),f="term-select"===d.type;return e&&0!==e&&(f=a.get.childSingle(b,e)),f},isTopParent:function(b,c){var d=a.get.metaKey(b);if(!d)return!0;var e=a.get.parent(b,c);return e&&0===e},isChild:function(b,c){var d=a.get.parent(b,c);return d===!1?!1:0!==d},parent:function(b,c){var d=a.get.term(b,c);return d?parseInt(d.parent):!1},remainingSelections:function(b,c){var d=a.get.maxSelections(b);if(d){var e=a.get.selected(b);return e=e?e.length:0,d-e}return!1},selected:function(a){var c=b('[name="'+a+'[]"]').map(function(){return b(this).val()}).get(),d=b.grep(c,function(a){return""!==a});return d},maxSelections:function(b,c){var d=a.get.metaKey(b);if(!d)return!1;var e=d.max_selections;if("undefined"!=typeof c&&c!==!1){var f=a.get.term(b,c);if(f&&f.child_max&&""!==f.child_max&&parseInt(f.child_max)>0)return parseInt(f.child_max)}return e=parseInt(e)>0&&""!==e&&e!==!1?parseInt(e):!1},exclude:function(b,c){var d=a.get.metaKey(b),e=c.toString();return d&&"undefined"!=typeof d.exclude&&-1!==d.exclude.indexOf(e)?!0:!1},description:function(b,c){var d=a.get.term(b,c);return d&&"undefined"!=typeof d.description?d.description:""},existingValue:function(b){var c=a.get.metaKey(b);if(c&&"undefined"!=typeof c.existing_value&&""!==c.existing_value){var d=c.existing_value;return"string"==typeof d&&(d=c.existing_value.split()),d}return[]},mkRequired:function(b){var c=a.get.metaKey(b);return c&&"undefined"!=typeof c.required?c.required:!1},mkReqLabel:function(b){var c=a.get.metaKey(b);return c&&"undefined"!=typeof c.required_label?c.required_label:""},mkOptLabel:function(b){var c=a.get.metaKey(b);return c&&"undefined"!=typeof c.optional_label?c.optional_label:""},mkShowRequired:function(b){var c=a.get.metaKey(b);return c&&"undefined"!=typeof c.show_required?c.show_required:!1},childRequired:function(b,c){var d=a.get.term(b,c);if(d&&"undefined"!=typeof d.child_required){if("inherit"==d.child_required)return a.get.mkRequired(b);if("required"===d.child_required)return!0;if("notrequired"===d.child_required)return!1}return!1},childPlaceholder:function(b,c){var d=a.get.term(b,c);return d&&"undefined"!=typeof d.child_placeholder&&""!==d.child_placeholder?d.child_placeholder:!1}},input:{value:{add:function(c,d){var e=b("#"+c);if(e){var f=e.val();f instanceof Array&&-1===f.indexOf(d)&&f.push(d),e.val(f),a.trigger.change(c,d)}},remove:function(c,d){var e=b("#"+c);if(e){var f=e.val();if(f instanceof Array){var g=f.indexOf(d);-1!==g&&f.splice(g,1)}e.val(f),a.trigger.change(c,d)}}}},trigger:{change:function(b,c,d){a.$form.trigger("fedtchange:"+b,[b,c,"someparams"])},newfieldset:function(b){a.$form.trigger("fedtnewfieldset",[b])}},remove:{children:function(c,d){var e=a.get.childrenIDs(c,d);b.each(e,function(d,e){var f=b(".fieldset-"+c+"_"+e);f&&f.remove(),a.remove.children(c,e)})}}};var c=1e3;"undefined"!=typeof jmfe_conditional_logic&&(b(document).on("felogic:init",function(){a.init.page()}),c=5e3),b(document).ready(function(){setTimeout(function(){a.init.page()},c)})}(jmfe_dynamictax,jQuery);