!function(){"use strict";jQuery((function(e){let a=5,s=a,i=0,r=0;var t=!0,n=!0;function c(a=0){let s=[];0==a&&e(".cariera-private-messages .conversation-list").html("");let i=0;for(i=0;i<500;i++)window.clearInterval(i);e(".cariera-private-messages #conversations .loader").fadeIn(),e(".cariera-private-messages .load-conversations button").prop("disabled",!0),o(),e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{action:"cariera_get_conversations",user_id:cariera_messages.login_user_id,lazy_load_limit:a},success:function(a){s=a,e(".cariera-private-messages .load-conversations button").html(cariera_messages.strings.load_conversations),""==a.length?e(".cariera-private-messages .load-conversations").addClass("d-none"):e(".cariera-private-messages .load-conversations").removeClass("d-none"),""==a.length?0==e(".cariera-private-messages .conversation-list li").length&&e(".cariera-private-messages .empty-inbox").removeClass("d-none"):e(".cariera-private-messages .empty-inbox").addClass("d-none");var i=a;i.sort((function(e,a){return new Date(a.last_message_time)-new Date(e.last_message_time)})),e.each(i,(function(a,s){var i=`\n                        <li data-id="${s.user_id}" data-listingid="${s.listing_id}" >\n                            <div class="list" data-id="${s.user_id}" data-listingid="${s.listing_id}" data-url="${s.listing_url}">\n                                <div class="user  ${s.from_id!=cariera_messages.login_user_id&&0==s.seen?"unseen-message":""}">\n                                    <div class="avatar"><img src="${0!=s.listing_id?s.listing_avatar_url:s.avatar_url}" alt="img"></div>\n                                    <div class="details">\n                                        <h4 class="title">${s.listing_name?s.display_name+'<span class="listing-title">  '+s.listing_name+"</span>":s.display_name}</h4>\n                                        <h5 class="message">${s.message}</h5>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="actions">\n                                <span class="time">${s.created_at}</span>\n                                <button><i class="fas fa-trash-alt"></i></button>\n                            </div>\n            \n                            <section class="delete-conversation d-none" id="d-alert-${s.user_id}" data-list="${s.listing_id}">\n                                <h6>${cariera_messages.strings.delete_conversation}</h6>\n                                <div class="delete-actions">\n                                    <button class="yes" id="d-alert-yes-${s.user_id}">\n                                        <i class="fas fa-check"></i>\n                                        <span>${cariera_messages.strings.yes}</span>\n                                    </button>\n                                    <button class="no" id="d-alert-no-${s.user_id}"> \n                                        <i class="fas fa-error"></i>\n                                        <span>${cariera_messages.strings.no}</span>\n                                    </button>\n                                </div>\n                            </section> \n                        </li>\n                    `;e(".cariera-private-messages .conversation-list").append(i),e(".cariera-private-messages .conversation-list li:last-child").hide().fadeIn(600),e(".cariera-private-messages .conversation-list .list").on("click",(function(){let a=e(this).data("id"),s=e(this).data("listingid"),i=e(this).find(".avatar img").attr("src");r=s,e(".avatar img").attr("src",i),0!=s?(e("#listing-url").attr("href",e(this).data("url")),e("#listing-url").removeClass("d-none")):e("#listing-url").addClass("d-none"),_(a,s)})),e(".cariera-private-messages .conversation-list .list").on("click",(function(){e("#conversations").addClass("d-none"),e("#chat-window").removeClass("d-none");let a=e(this).find(".details .title").html();e(".cariera-private-messages .info.name .title").html(a)})),e("#compose-message").on("click",(function(){e("#conversations").addClass("d-none"),e("#find-user").removeClass("d-none")})),e(".cariera-private-messages .conversation-list .actions").on("click",(function(){k(e(this).parent().data("id"),e(this).parent().data("listingid"))}))})),e(".cariera-private-messages #conversations .loader").fadeOut(400),e(".cariera-private-messages .load-conversations button").prop("disabled",!1)}}),l()}function l(){let a=[];e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{action:"cariera_get_conversations",user_id:cariera_messages.login_user_id},beforeSend:function(){},success:function(s){let r=0;0==r&&(a=s,r++),s.length!=a.length&&(c(),a=s);var t=s,n=0,l=[];if(e.each(t,(function(e,a){a.from_id!=cariera_messages.login_user_id&&0==a.seen&&(l.push(a.user_id),n++)})),n>i){var o=[];e(".cariera-private-messages .conversation-list li").each((function(){o.push(e(this).data("id"))})),o.includes(l)||c(),i=n}else n=0;e.each(t,(function(a,s){if(s.from_id!=cariera_messages.login_user_id&&0==s.seen){let a=e(`.cariera-private-messages .conversation-list li[data-id="${s.user_id}"][data-listingid="${s.listing_id}"]`);a.data("message",s.message_id),a.find(".user").addClass("unseen-message"),a.find(".details .message").text(`${s.message}`)}else{let a=e(`.cariera-private-messages .conversation-list li[data-id="${s.user_id}"][data-listingid="${s.listing_id}"]`);a.data("message",s.message_id),a.find(".user").removeClass("unseen-message"),a.find(".details .message").text(s.message)}}))},error:function(){console.log("there has been an error")},complete:function(){1==t&&setTimeout(l,cariera_messages.autoload_interval)}})}function o(){e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{action:"cariera_get_conversations",user_id:cariera_messages.login_user_id},success:function(a){var s=a,r=0;e.each(s,(function(e,a){a.from_id!=cariera_messages.login_user_id&&0==a.seen&&r++})),i=r,r>0?(e(".private-messages-trigger .notification-count").text(r),e(".private-messages-trigger .notification-count").removeClass("d-none")):(e(".private-messages-trigger .notification-count").text(r),e(".private-messages-trigger .notification-count").addClass("d-none"))},complete:function(){setTimeout((function(){d()}),cariera_messages.autoload_interval)}})}function d(){e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{action:"cariera_get_conversations",user_id:cariera_messages.login_user_id},success:function(a){var s=a,i=0;e.each(s,(function(e,a){a.from_id!=cariera_messages.login_user_id&&0==a.seen&&i++})),i>0?(e(".private-messages-trigger .notification-count").text(i),e(".private-messages-trigger .notification-count").removeClass("d-none")):(e(".private-messages-trigger .notification-count").text(i),e(".private-messages-trigger .notification-count").addClass("d-none"))},complete:function(){setTimeout((function(){d()}),cariera_messages.autoload_interval)}})}o();let g=[],m=[],u="",v=null;function _(a,s=null){u=a,v=s,n=!0;let i=0;for(i=0;i<500;i++)window.clearInterval(i);e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{login_user:cariera_messages.login_user_id,selected_user:u,action:"cariera_check_block_status"},success:function(a){"true"==a.status?(a.id==cariera_messages.login_user_id&&e(".cariera-private-messages .user-blocked").text(cariera_messages.strings.user_blocked_msg),a.id!=cariera_messages.login_user_id&&(e(".cariera-private-messages .user-blocked").text(cariera_messages.strings.user_block_msg),e(".cariera-private-messages #unblock-user").removeClass("d-none")),e(".cariera-private-messages .user-blocked").removeClass("d-none"),e(".cariera-private-messages #block-user").addClass("d-none")):(e(".cariera-private-messages .user-blocked").addClass("d-none"),e(".cariera-private-messages #block-user").removeClass("d-none"))}}),e(".cariera-private-messages .chat-list").html(""),e(".cariera-private-messages .chat-area .loader").fadeIn(),e(".cariera-private-messages .messages-wrapper .action-btn.send-message").prop("disabled",!0),e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{from:cariera_messages.login_user_id,to:u,listing_id:s,action:"cariera_get_user_message"},success:function(a){let s=a;e(".chat-list").html(""),e.each(s,(function(a,s){s.from_id==cariera_messages.login_user_id?e(".chat-list").prepend(`\n                            <li data-id="${s.id}" class="responder-2">\n                                <div class="replay-message-2">\n                                    <h6 class="time">${s.created_at}</h6>\n                                    <div class="message">\n                                        <p class="message-item">${s.message}</p>\n                                        <div class="user">\n                                            <div class="avatar"><img src="${s.avatar_url}" alt="img"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </li>\n                        `):u!=cariera_messages.login_user_id&&e(".chat-list").prepend(`\n                            <li data-id="${s.id}" class="responder-1">\n                                <div class="replay-message-1">\n                                    <h6 class="time">${s.created_at}</h6>\n                                    <div class="message">\n                                        <div class="user">\n                                            <div class="avatar"><img src="${s.avatar_url}" alt="img"></div>\n                                        </div>\n                                        <p class="message-item reply">${s.message}</p>\n                                    </div>\n                                </div>\n                            </li>     \n                        `)})),g=s,e(".chat-list").scrollTop(e(".chat-list")[0].scrollHeight),e(".cariera-private-messages .chat-area .loader").fadeOut(400),e(".cariera-private-messages .messages-wrapper .action-btn.send-message").prop("disabled",!1)},complete:function(){setTimeout((function(){p(s)}),cariera_messages.autoload_interval)}})}function p(a=null){e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{from:cariera_messages.login_user_id,to:u,listing_id:a,action:"cariera_get_user_message"},success:function(a){m=a;let s=m.filter((function(e){return!g.some((function(a){return a.id==e.id}))}));g=m,e.each(s,(function(a,s){s.from_id==cariera_messages.login_user_id||s.form_id!=cariera_messages.login_user_id&&(e(".chat-list").append(`\n                            <li data-id="${s.id}" class="responder-1">\n                                <div class="replay-message-1">\n                                    <h6 class="time">${s.created_at}</h6>\n                                    <div class="message">\n                                        <div class="user">\n                                            <div class="avatar"><img src="${s.avatar_url}" alt="img"></div>\n                                        </div>\n                                        <p class="message-item reply">${s.message}</p>\n                                    </div>\n                                </div>\n                            </li>\n                        `),e(".chat-list").scrollTop(e(".chat-list")[0].scrollHeight))}))},complete:function(){1==n&&setTimeout((function(){p(a)}),cariera_messages.autoload_interval)}})}function f(){let a=u,s=e(".cariera-private-messages .write-msg").val(),i=Math.floor(999*Math.random());e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{from:cariera_messages.login_user_id,to:a,msg_uid:i,listing_id:v,message:s,action:"cariera_send_message"},beforeSend:function(){if(""!=s){var a=`   \n                        <li data-id="" class="responder-2 sending" data-msg-uid="${i}">\n                            <div class="replay-message-2">\n                                <h6 class="time">${cariera_messages.strings.sending_time}</h6>\n                                <div class="message">\n                                    <p class="message-item">${s}</p>\n                                    <div class="user">\n                                        <div class="avatar"><img src="${cariera_messages.avatar_url}" alt=""></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </li>\n                    `;e(".chat-list").append(a),e(".cariera-private-messages .write-msg").val(""),e(".chat-list").scrollTop(e(".chat-list")[0].scrollHeight)}},success:function(a){"error"==a.status&&(e(".cariera-private-messages .warning-alert p").text(a.message),e(".cariera-private-messages .warning-alert").fadeIn(100),setTimeout((()=>{e(".cariera-private-messages .warning-alert").fadeOut()}),4e3),e(".chat-list li.sending").removeClass("sending").addClass("error")),e('.chat-list li[data-msg-uid="'+a.message_unique_id+'"]').removeClass("sending")}})}e(".cariera-private-messages .write-msg").on("keypress",(function(a){13==a.which&&(a.preventDefault(),f(),e(this).val(""))}));let h=10;var b=!1;function k(a=null,s=null){a?(e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"]').removeClass("d-none"),e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"]').find(".delete-actions .yes").on("click",(function(){e(this).unbind("click"),e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{user_id:cariera_messages.login_user_id,delete_user_id:a,listing_id:s,action:"cariera_delete_conversation"},beforeSend:function(){e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"] h6').text(cariera_messages.strings.please_wait),e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"] .delete-actions').addClass("d-none")},success:function(i){e(".cariera-private-messages .conversation-list").find('li[data-id="'+a+'"][data-listingid="'+s+'"]').remove()}})})),e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"]').find(".delete-actions .no").on("click",(function(){e(this).unbind("click"),e(".cariera-private-messages .conversation-list").find('section[id="d-alert-'+a+'"][data-list="'+s+'"]').addClass("d-none")}))):(e(".cariera-private-messages .delete-alert").removeClass("d-none"),e(".cariera-private-messages .delete-alert .action .yes").on("click",(function(){e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{user_id:cariera_messages.login_user_id,delete_user_id:u,listing_id:r,action:"cariera_delete_conversation"},beforeSend:function(){e(".cariera-private-messages .delete-alert h6").text(cariera_messages.strings.please_wait),e(".cariera-private-messages .delete-alert .action").addClass("d-none")},success:function(a){"success"==a.status&&(h=10,e(".cariera-private-messages .conversation-list").html(""),e(".cariera-private-messages #conversations").removeClass("d-none"),e(".cariera-private-messages #chat-window").addClass("d-none"),e(".cariera-private-messages #find-user").addClass("d-none"),e(".cariera-private-messages .delete-alert").addClass("d-none"),e(".cariera-private-messages .delete-alert h6").text(cariera_messages.strings.delete_conversation),e(".cariera-private-messages .delete-alert .action").removeClass("d-none"),c(),v=null,t=!0,n=!1)}})})),e(".cariera-private-messages .delete-alert .action .no").on("click",(function(){e(".cariera-private-messages .delete-alert").addClass("d-none")})))}e(".chat-list").on("scroll",(function(){e(".chat-list li").length>0&&0==e(this).scrollTop()&&e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{from:cariera_messages.login_user_id,to:u,lazy_load_range:h,listing_id:v,action:"cariera_get_user_message"},beforeSend:function(){0==b&&e(".cariera-private-messages .loading-messages").fadeIn(0)},success:function(a){a.length>0?e(".cariera-private-messages .loading-messages").fadeOut(0):(e(".cariera-private-messages .loading-messages").fadeOut(0),b=!0);let s=a;if(e.each(s,(function(a,s){s.from_id==cariera_messages.login_user_id?e(".chat-list").prepend(`\n                                        <li data-id="${s.id}" class="responder-2">\n                                            <div class="replay-message-2">\n                                                <h6 class="time">${s.created_at}</h6>\n                                                <div class="message">\n                                                    <p class="message-item">${s.message}</p>\n                                                    <div class="user">\n                                                        <div class="avatar"><img src="${s.avatar_url}" alt="img"></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </li>\n                                    `):u!=cariera_messages.login_user_id&&e(".chat-list").prepend(`\n                                        <li data-id="${s.id}" class="responder-1">\n                                            <div class="replay-message-1">\n                                            <h6 class="time">${s.created_at}</h6>\n                                            <div class="message">\n                                                <div class="user">\n                                                    <div class="avatar"><img src="${s.avatar_url}" alt="img"></div>\n                                                </div>\n                                                <p class="message-item reply">${s.message}</p>\n                                            </div>\n                                            </div>\n                                        </li>\n                                    `)})),""!=s){let a=s[0].id;e(".chat-list").scrollTop(e('.chat-list li[data-id="'+a+'"]').offset().top)}h+=10}})})),e(".cariera-private-messages .load-conversations button").on("click",(function(){e(".cariera-private-messages .load-conversations button").html(cariera_messages.strings.loading),c(a),a+=5})),e(".cariera-private-messages .conversation-list .list").on("click",(function(){e(".cariera-private-messages #conversations").addClass("d-none"),e(".cariera-private-messages #chat-window").removeClass("d-none");let a=e(this,"h4").text();b=!1,t=!1,e(".cariera-private-messages .info.name h4").text(a)})),e(".cariera-private-messages .back-to-conversations").on("click",(function(){c(),h=10,b=!1,t=!0,n=!1,e(".cariera-private-messages .conversation-list").html(""),e(".cariera-private-messages #conversations").removeClass("d-none"),e(".cariera-private-messages #chat-window").addClass("d-none"),e(".cariera-private-messages #find-user").addClass("d-none"),e(".cariera-private-messages .user-blocked").addClass("d-none"),a=s})),e(".cariera-private-messages #compose-message").on("click",(function(){e(".cariera-private-messages #conversations").addClass("d-none"),e(".cariera-private-messages #find-user").removeClass("d-none"),t=!1})),e(".listing-btn").on("click",(function(){e(".cariera-private-messages #conversations").addClass("d-none"),e(".cariera-private-messages #chat-window").removeClass("d-none"),e(".cariera-private-messages .info.name .title").text(e(this).data("title")),e(".cariera-private-messages .avatar img").attr("src",e(this).data("image")).css("object-fit","cover"),_(e(this).data("author"),e(this).data("id"))})),e(".cariera-private-messages .send-message").on("click",(function(){f()})),e(".private-messages-trigger").on("click",(function(){t=!0,n=!0,c()})),e(".cariera-private-messages #block-user").on("click",(function(){e(".cariera-private-messages .block-alert h6").text(cariera_messages.strings.block_msg),e(".cariera-private-messages .user-blocked").text(cariera_messages.strings.user_block_msg),e(".cariera-private-messages .block-alert").removeClass("d-none"),e(".cariera-private-messages .block-alert .action .yes").on("click",(function(){e(this).unbind("click"),e(".cariera-private-messages .block-alert").addClass("d-none"),e(".cariera-private-messages .user-blocked").removeClass("d-none"),e(".cariera-private-messages #block-user").addClass("d-none"),e(".cariera-private-messages #unblock-user").removeClass("d-none"),e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{user_id:cariera_messages.login_user_id,block_user_id:u,action:"cariera_block_user"},success:function(e){}})})),e(".cariera-private-messages .block-alert .action .no").on("click",(function(){e(".block-alert").addClass("d-none")}))})),e(".cariera-private-messages #unblock-user").on("click",(function(){e(".cariera-private-messages .block-alert h6").text(cariera_messages.strings.unblock_msg),e(".cariera-private-messages .block-alert").removeClass("d-none"),e(".cariera-private-messages .block-alert .action .yes").on("click",(function(){e(this).unbind("click"),e(".cariera-private-messages .block-alert").addClass("d-none"),e(".cariera-private-messages .user-blocked").addClass("d-none"),e(".cariera-private-messages #block-user").removeClass("d-none"),e(".cariera-private-messages #unblock-user").addClass("d-none"),e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{user_id:cariera_messages.login_user_id,unblock_user_id:u,action:"cariera_unblock_user"},success:function(e){}})})),e(".cariera-private-messages .block-alert .action .no").on("click",(function(){e(".cariera-private-messages .block-alert").addClass("d-none")}))})),e(".cariera-private-messages #delete-conversation").on("click",(function(){k()})),e(".cariera-private-messages .mfp-close").on("click",(function(){t=!1})),e(".cariera-private-messages #user-search").on("keypress",(function(){let a=e(this).val();a.length>1&&(e(".cariera-private-messages .compose-user-search .search-results").fadeIn(),function(a){e.ajax({url:cariera_messages.ajax_url,type:"POST",data:{user_search:a,action:"cariera_user_search"},beforeSend:function(){e(".cariera-private-messages .compose-user-search").addClass("searching"),e(".cariera-private-messages .compose-user-search ul").html("")},success:function(a){e(".cariera-private-messages .compose-user-search ul").html(""),"empty"==a.status?e(".cariera-private-messages .compose-user-search ul").append(`\n                        <li class="not-found">\n                            <div class="info">\n                                <h4>${cariera_messages.strings.user_not_found}</h4>\n                            </div>\n                        </li>\n                    `):e.each(a,(function(a,s){e(".cariera-private-messages .compose-user-search ul").append(`\n                            <li class="user" data-userid="${s.id}" data-avatar="${s.avatar}">\n                                <div class="info">\n                                    <h4>${s.login}</h4>\n                                </div>\n                            </li>\n                        `)})),e(".cariera-private-messages .compose-user-search").removeClass("searching"),e(".cariera-private-messages .compose-user-search ul li.user").on("click",(function(){let a=e(this).data("userid"),s=e(this,"h4").text(),i=e(this).data("avatar");e(".cariera-private-messages #user-search").val(""),e(".cariera-private-messages .compose-user-search .search-results").fadeOut(),e(".cariera-private-messages .compose-user-search ul").html(""),e(".cariera-private-messages #find-user").addClass("d-none"),e(".cariera-private-messages #chat-window").removeClass("d-none"),e(".cariera-private-messages .info.name .title").html(s),e(".cariera-private-messages .avatar img").attr("src",i).css("object-fit","cover"),_(a)}))}})}(a))}))}))}();